---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

export async function getStaticPaths() {
  const allRecipes = await getCollection('dishes');

  // Get unique categories
  const categories = [...new Set(allRecipes.map(recipe => recipe.slug.split('/')[0]))];

  return categories.map(category => {
    const categoryRecipes = allRecipes.filter(recipe => recipe.slug.startsWith(category + '/'));
    return {
      params: { category },
      props: { category, recipes: categoryRecipes },
    };
  });
}

const { category, recipes } = Astro.props;
const baseUrl = import.meta.env.BASE_URL;
---

<Layout title={`Recetas de ${category}`}>
  <div class="mb-8 flex items-center gap-4">
    <a href={baseUrl} class="text-primary hover:underline">Inicio</a>
    <span class="text-gray-400">/</span>
    <h1 class="text-3xl font-bold capitalize text-dark">{category.replace(/_/g, ' ')}</h1>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    {recipes.map((recipe) => (
      <a
        href={`${baseUrl}/recipes/${recipe.slug}`}
        class="bg-white p-6 rounded-xl shadow-md hover:shadow-xl transition-all duration-300 group"
      >
        <h3 class="text-xl font-semibold text-dark group-hover:text-primary transition-colors mb-2">
          {recipe.id.split('/').pop()?.replace('.md', '')}
        </h3>
        <p class="text-gray-500 text-sm truncate">
          {recipe.slug}
        </p>
      </a>
    ))}
  </div>
</Layout>
