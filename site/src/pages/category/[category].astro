---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

export async function getStaticPaths() {
  const allRecipes = await getCollection('dishes');

  // Get unique categories
  const categories = [...new Set(allRecipes.map(recipe => recipe.slug.split('/')[0]))];

  return categories.map(category => {
    const categoryRecipes = allRecipes.filter(recipe => recipe.slug.startsWith(category + '/'));
    return {
      params: { category },
      props: { category, recipes: categoryRecipes },
    };
  });
}

const { category, recipes } = Astro.props;
const baseUrl = import.meta.env.BASE_URL;
---

<Layout title={`Recetas de ${category}`}>
  <div class="mb-12 flex items-center gap-4 font-mono text-sm uppercase tracking-widest">
    <a href={baseUrl} class="text-primary hover:text-white transition-colors">Inicio</a>
    <span class="text-gray-600">/</span>
    <h1 class="text-3xl font-bold capitalize text-light">{category.replace(/_/g, ' ')}</h1>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    {recipes.map((recipe) => (
      <a
        href={`${baseUrl}/recipes/${recipe.slug}`}
        class="bg-surface border border-gray-800 p-6 rounded-none hover:border-primary transition-all duration-300 group relative overflow-hidden hover:shadow-neon"
      >
        <div class="absolute top-0 left-0 w-1 h-full bg-gradient-to-b from-primary to-secondary transform scale-y-0 group-hover:scale-y-100 transition-transform duration-300 origin-top"></div>
        <h3 class="text-xl font-bold text-light group-hover:text-primary transition-colors mb-2 font-mono pl-2">
          {recipe.id.split('/').pop()?.replace('.md', '')}
        </h3>
        <p class="text-muted text-xs font-mono truncate pl-2 border-l border-gray-800 group-hover:border-primary/50 transition-colors">
          {recipe.slug}
        </p>
      </a>
    ))}
  </div>
</Layout>
