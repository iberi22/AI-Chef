---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';

const allRecipes = await getCollection('dishes');

// Group by category (first part of the slug)
const recipesByCategory = allRecipes.reduce((acc, recipe) => {
  const category = recipe.slug.split('/')[0];
  if (!acc[category]) {
    acc[category] = [];
  }
  acc[category].push(recipe);
  return acc;
}, {} as Record<string, typeof allRecipes>);

const categories = Object.keys(recipesByCategory).sort();
const baseUrl = import.meta.env.BASE_URL;
---

<Layout title="AI-Chef - Recetario Inteligente">
  <div class="text-center mb-12">
    <h1 class="text-4xl md:text-5xl font-bold text-primary mb-4">AI-Chef</h1>
    <p class="text-xl text-gray-600">Colecci√≥n de recetas curadas y mejoradas con IA</p>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
    {categories.map((category) => (
      <div class="bg-white rounded-xl shadow-md overflow-hidden hover:shadow-xl transition-shadow duration-300">
        <div class="bg-secondary/10 p-4 border-b border-secondary/20">
          <h2 class="text-2xl font-bold text-dark capitalize">
            {category.replace(/_/g, ' ')}
          </h2>
          <span class="text-sm text-gray-500">{recipesByCategory[category].length} recetas</span>
        </div>
        <ul class="p-4 space-y-2 max-h-64 overflow-y-auto custom-scrollbar">
          {recipesByCategory[category].slice(0, 5).map((recipe) => (
            <li>
              <a
                href={`${baseUrl}/recipes/${recipe.slug}`}
                class="block p-2 hover:bg-light rounded transition-colors text-gray-700 hover:text-primary truncate"
              >
                {recipe.id.split('/').pop()?.replace('.md', '') || recipe.slug}
              </a>
            </li>
          ))}
          {recipesByCategory[category].length > 5 && (
            <li>
              <a href={`${baseUrl}/category/${category}`} class="block text-center text-primary font-semibold mt-2 hover:underline">
                Ver todas ({recipesByCategory[category].length})
              </a>
            </li>
          )}
        </ul>
      </div>
    ))}
  </div>
</Layout>

<style>
  .custom-scrollbar::-webkit-scrollbar {
    width: 6px;
  }
  .custom-scrollbar::-webkit-scrollbar-track {
    background: #f1f1f1;
  }
  .custom-scrollbar::-webkit-scrollbar-thumb {
    background: #ccc;
    border-radius: 3px;
  }
</style>

