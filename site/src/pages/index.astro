---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';

const allRecipes = await getCollection('dishes');

// Group by category (first part of the slug)
const recipesByCategory = allRecipes.reduce((acc, recipe) => {
  const category = recipe.slug.split('/')[0];
  if (!acc[category]) {
    acc[category] = [];
  }
  acc[category].push(recipe);
  return acc;
}, {} as Record<string, typeof allRecipes>);

const categories = Object.keys(recipesByCategory).sort();
const baseUrl = import.meta.env.BASE_URL;
---

<Layout title="AI-Chef - Recetario Inteligente">
  <div class="text-center mb-16 relative">
    <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-32 h-32 bg-primary/20 blur-[100px] rounded-full pointer-events-none"></div>
    <h1 class="text-5xl md:text-7xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-primary via-white to-secondary mb-4 tracking-tighter">AI-Chef</h1>
    <p class="text-xl text-muted font-mono uppercase tracking-widest">Colecci√≥n de recetas curadas y mejoradas con IA</p>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    {categories.map((category) => (
      <div class="bg-surface border border-gray-800 hover:border-primary transition-all duration-300 rounded-none relative group hover:shadow-neon">
        <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-primary to-secondary transform scale-x-0 group-hover:scale-x-100 transition-transform duration-300 origin-left"></div>
        <div class="bg-dark/50 p-4 border-b border-gray-800 flex justify-between items-center">
          <h2 class="text-xl font-bold text-light capitalize font-mono">
            {category.replace(/_/g, ' ')}
          </h2>
          <span class="text-xs text-primary border border-primary/30 px-2 py-1 bg-primary/5">
            {recipesByCategory[category].length}
          </span>
        </div>
        <ul class="p-4 space-y-1 max-h-64 overflow-y-auto custom-scrollbar">
          {recipesByCategory[category].slice(0, 5).map((recipe) => (
            <li>
              <a
                href={`${baseUrl}/recipes/${recipe.slug}`}
                class="block p-2 hover:bg-dark/50 hover:text-primary transition-colors text-muted truncate font-mono text-sm border-l-2 border-transparent hover:border-primary"
              >
                {recipe.id.split('/').pop()?.replace('.md', '') || recipe.slug}
              </a>
            </li>
          ))}
          {recipesByCategory[category].length > 5 && (
            <li>
              <a href={`${baseUrl}/category/${category}`} class="block text-center text-secondary text-xs mt-4 hover:text-white transition-colors uppercase tracking-widest border border-gray-800 hover:border-secondary py-2">
                Ver todas ({recipesByCategory[category].length})
              </a>
            </li>
          )}
        </ul>
      </div>
    ))}
  </div>
</Layout>

<style>
  .custom-scrollbar::-webkit-scrollbar {
    width: 4px;
  }
  .custom-scrollbar::-webkit-scrollbar-track {
    background: #111;
  }
  .custom-scrollbar::-webkit-scrollbar-thumb {
    background: #333;
  }
  .custom-scrollbar::-webkit-scrollbar-thumb:hover {
    background: #00f0ff;
  }
</style>

