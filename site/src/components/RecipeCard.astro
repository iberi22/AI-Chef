---
interface Props {
  title: string;
  slug: string;
  image?: string;
  category?: string;
  region?: string;
  originalName?: string;
  difficulty?: string;
  time?: string;
  calories?: string | number;
  rating?: number;
}

const { title, slug, image, category, region, originalName, difficulty, time, calories, rating } = Astro.props;
const baseUrl = import.meta.env.BASE_URL;

function formatNumber(num: number | undefined) {
    return num ? num.toString() : '-';
}
---

<div class="group relative flex flex-col overflow-hidden rounded-xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-black shadow-sm transition-all hover:shadow-md">
  <!-- Instagram Header -->
  <div class="flex items-center gap-3 p-3">
    <div class="h-8 w-8 overflow-hidden rounded-full ring-2 ring-primary/20">
       <img src={`${baseUrl}/images/logo.png`} alt="AI Chef" class="h-full w-full object-cover" loading="lazy" />
    </div>
    <div class="flex flex-col">
      <div class="flex items-center gap-1">
          <span class="text-xs font-bold text-text-light dark:text-text-dark">ai_chef_official</span>
          {region && <span class="text-[10px] text-gray-400">‚Ä¢ {region}</span>}
      </div>
      <span class="text-[10px] text-gray-500 capitalize">{category || 'Cooking'} {time && `‚Ä¢ ‚è±Ô∏è ${time}`}</span>
    </div>
    <span class="material-symbols-outlined ml-auto text-xl text-gray-400">more_horiz</span>
  </div>

  <!-- Main Image (Square) -->
  <div class="relative aspect-square w-full overflow-hidden bg-gray-100 dark:bg-gray-900">
    <a href={`${baseUrl}/recipes/${slug}`} class="absolute inset-0 z-10 block" aria-label={`View recipe: ${title}`}></a>
    {image ? (
      <img
        src={image}
        alt={title}
        class="h-full w-full object-cover transition-transform duration-700 group-hover:scale-105"
        loading="lazy"
      />
    ) : (
      <div class="flex h-full w-full items-center justify-center text-gray-300 dark:text-gray-700">
        <span class="material-symbols-outlined text-6xl">restaurant</span>
      </div>
    )}

    <!-- Original Name Badge (Overlay) -->
    {originalName && (
        <div class="absolute bottom-3 right-3 z-20">
             <span class="rounded-md bg-black/60 px-2 py-1 text-xs font-medium text-white backdrop-blur-sm">
                {originalName}
             </span>
        </div>
    )}
  </div>

  <!-- Action Bar -->
  <div class="flex items-center justify-between px-3 py-3">
    <div class="flex items-center gap-4">
      <button
        class="fav-btn group/btn flex items-center justify-center transition-transform active:scale-90"
        data-slug={slug}
        aria-label="Like"
      >
        <span class="material-symbols-outlined text-2xl text-text-light dark:text-text-dark font-variation-settings-fill group-hover/btn:text-primary transition-colors">favorite</span>
      </button>
      <button class="flex items-center justify-center hover:opacity-70 transition-opacity">
        <span class="material-symbols-outlined text-2xl text-text-light dark:text-text-dark -rotate-90">chat_bubble</span>
      </button>
      <button class="flex items-center justify-center hover:opacity-70 transition-opacity">
        <span class="material-symbols-outlined text-2xl text-text-light dark:text-text-dark">send</span>
      </button>
    </div>
    <button class="flex items-center justify-center hover:opacity-70 transition-opacity">
        <span class="material-symbols-outlined text-2xl text-text-light dark:text-text-dark">bookmark</span>
    </button>
  </div>

  <!-- Stats Grid (New) -->
  <div class="mx-3 mb-3 grid grid-cols-4 gap-2 rounded-lg bg-gray-50 dark:bg-gray-900/50 p-2 text-center text-[10px] text-gray-500 dark:text-gray-400">
      <div class="flex flex-col items-center gap-0.5">
          <span class="material-symbols-outlined text-sm text-primary">schedule</span>
          <span>{time || '-'}</span>
      </div>
       <div class="flex flex-col items-center gap-0.5">
          <span class="material-symbols-outlined text-sm text-orange-400">local_fire_department</span>
          <span>{calories ? `${calories} kcal` : '-'}</span>
      </div>
       <div class="flex flex-col items-center gap-0.5">
          <span class="material-symbols-outlined text-sm text-yellow-500">star</span>
          <span>{rating ? rating : '-'}</span>
      </div>
      <div class="flex flex-col items-center gap-0.5">
          <span class="material-symbols-outlined text-sm text-green-500">bar_chart</span>
          <span>{difficulty || '-'}</span>
      </div>
  </div>

  <!-- Likes & Caption -->
  <div class="flex flex-col gap-1 px-3 pb-4">
    <div class="text-xs font-bold text-text-light dark:text-text-dark">
      Liked by <span class="text-text-light dark:text-text-dark">foodie_lover</span> and <span class="font-bold">others</span>
    </div>
    <div class="text-sm">
      <span class="font-bold text-text-light dark:text-text-dark mr-2">ai_chef_official</span>
      <span class="text-gray-600 dark:text-gray-300 line-clamp-2">
        {title} ü•ò Discover the logic behind this delicious dish. #foodie #coding #{category}
      </span>
    </div>
    <div class="mt-1 flex items-center gap-3">
      <a href={`${baseUrl}/recipes/${slug}`} class="text-xs text-gray-400 hover:text-primary uppercase font-bold tracking-wider">
        View Recipe Logic
      </a>
      <a
        href={`https://github.com/iberi22/AI-Chef/issues/new?title=${encodeURIComponent(`üì∏ Add image for: ${title}`)}&body=${encodeURIComponent(`## Recipe Image Submission\n\n**Recipe:** ${title}\n**Path:** dishes/${slug}/images/\n\n### Instructions:\n1. Attach your image(s) below\n2. Images should be high quality food photography\n3. Accepted formats: JPG, PNG, WebP\n\n### Your Image(s):\n<!-- Drag and drop your images here -->\n\n### Photographer Credit (optional):\n`)}&labels=community-image`}
        target="_blank"
        rel="noopener noreferrer"
        class="flex items-center gap-1 text-xs text-gray-400 hover:text-secondary transition-colors"
        title="Submit your own image for this recipe"
      >
        <span class="material-symbols-outlined text-sm">add_a_photo</span>
        <span class="uppercase font-bold tracking-wider">Add Photo</span>
      </a>
    </div>
  </div>
</div>

<style>
  .font-variation-settings-fill {
    font-variation-settings: 'FILL' 0;
    transition: font-variation-settings 0.3s ease;
  }
  :global(.fav-btn.active) .font-variation-settings-fill {
    font-variation-settings: 'FILL' 1;
    color: #FF0000; /* Red Heart */
  }
  :global(.fav-btn.active) {
    /* No bg change needed, just icon color */
  }
</style>
